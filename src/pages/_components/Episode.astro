---
import { Image } from "astro:assets";

interface Props {
  name: string;
  published: string;
  length: string;
  image: ImageMetadata;
  description: string;
  id: string;
  background: string;
  accent: string;
}

const { name, published, length, image, description, id, background, accent } =
  Astro.props;

function oklchWithAlpha(color: string, alpha = 0.55) {
  if (!color) return color;
  if (!color.startsWith("oklch(")) return color;
  if (/\/\s*\d*\.?\d+\s*\)/.test(color)) return color;
  return color.replace(/oklch\(([^)]+)\)/, (_, inner) => {
    const trimmed = inner.trim();
    return `oklch(${trimmed} / ${alpha})`;
  });
}

const translucentBg = oklchWithAlpha(background, 0.4);
---

<div
  class="overflow-hidden bg-white rounded-4xl shadow-xl shadow-emerald-800/5
            flex flex-col sm:grid sm:grid-cols-12"
>
  <div
    class="sm:col-span-4 sm:col-start-9 md:col-span-3 md:col-start-10 flex justify-center"
  >
    <Image
      class={`inset-0 w-full h-40 sm:h-full object-cover`}
      src={image}
      width={300}
      height={300}
      alt={`Illustrasjon for episoden ${name}`}
    />
  </div>

  <div
    class="p-6 sm:py-6 sm:px-8 sm:col-span-8 md:col-span-9 sm:col-start-1 sm:row-start-1 xl:pr-12"
    style={{ background: translucentBg }}
  >
    <h3 style={{ color: accent }} class="text-xl font-bold mb-2">
      {name}
    </h3>
    <div style={{ color: accent }} class="font-semibold mb-1">
      Varighet: <span class="font-normal">{length}</span> • Utgitt: <span
        class="font-normal">{published}</span
      >
    </div>
    <p class="text-base leading-5 mb-6">
      {description}
    </p>
    <div>
      <a
        href={`${import.meta.env.BASE_URL}episodes/${id}`}
        class="font-semibold text-white px-4 py-2 rounded-full"
        style={{ background: accent }}>Hør nå</a
      >
    </div>
  </div>
</div>
